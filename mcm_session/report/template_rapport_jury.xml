<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="header_rapport_jury">

        <t t-if="o.ville_jury_id.name_ville != 'Paris'">
            <div class="row">
                <br/>
                <img src='/mcm_session/static/src/img/header_jury.png' height="300" width="2000"/>
            </div>
        </t>
        <t t-else="">
            <div class="row">
                <br/>
                <img src='/mcm_session/static/src/img/La_DRIEAT_Ile-de-France.png' height="300"
                     width="2000"/>
            </div>
        </t>
    </template>


    <template id="template_raport_jury_ids">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.basic_layout">
                    <style>
                        .page {
                        line-height: 1.75 ;
                        font-size:20px ;
                        }
                        .margin { margin-top: 0px;}
                    </style>
                    <div class="page margin">
                        <div class="oe_structure"/>
                        <t t-call="mcm_session.header_rapport_jury"/>
                        <div class="row" style="margin-left:10%;margin-right:10%;">
                            <div class="col-12">
                                <span>
                                    <b>
                                        <u>SESSION DU
                                            <span t-esc="o.date_session_frensh(date_examen)"/>
                                        </u>
                                    </b>
                                </span>
                                <br/>
                                <br/>
                                <p>L'AN
                                    <span t-esc="docs.date_to_text(yearformat,monthformat)"/>
                                    <span t-esc="o.month_session_in_lettre(month_format)"/>
                                </p>
                                <br/>
                                <style>
                                    .tr, .td , .table, .tbody{
                                    padding: 1px;
                                    border: solid;
                                    }
                                </style>
                                <center style="padding-top:60px!important;">
                                    <table class="table">
                                        <tr align="center">
                                            <th colspan="2">CENTRE ORGANISATEUR DE L’EXAMEN</th>
                                        </tr>
                                        <tbody>
                                            <tr class="tr" style="height:100px;width:200px;">
                                                <td class="td" align="center" style="height: 80px; width: 80px;">
                                                    <b>Numéro d’agrément</b>
                                                </td>
                                                <td class="td" align="center" style="height: 80px; width: 80px;">
                                                    <strong>
                                                        <p>MCM ACADEMY</p>
                                                        <span t-raw="'%s' % o.num_agrement_jury"/>
                                                    </strong>
                                                </td>
                                            </tr>
                                            <tr class="tr" style="height:100px;width:200px;">
                                                <td class="td" align="center" style="height: 80px; width: 80px;">
                                                    <b>Lieu de réalisation de la session</b>
                                                </td>
                                                <td class="td" align="center" style="height: 80px; width: 80px;">
                                                    <strong>
                                                        <span t-raw="'%s' % o.ville_jury_id.name_ville"/>:
                                                        <span t-raw="'%s' % o.adresse_jury_id.adresse_centre_examen"/>
                                                    </strong>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </center>
                            </div>
                        </div>

                        <p style="page-break-after:always;"/>
                        <div class="row">
                            <img src='/mcm_session/static/src/img/header_middle.png' height="60" width="2000"/>
                        </div>
                        <div class="page" style="margin-left:10%;margin-right:10%;">

                            <span>
                                <p style="padding-top:50px;">
                                    <strong>
                                        <u>Stagiaires :</u>
                                    </strong>
                                </p>
                            </span>
                            <br/>
                            <style>.tab {
                                display: inline-block;
                                margin-left: 40px;
                                }
                            </style>
                            <span class="tab" style="font-size:22px;">
                                <p>a) Nombre de candidats inscrits et présents :</p>
                                <p>- Le nombre de candidats inscrits était de
                                    <span t-esc="docs.nbr_client_par_session(nbr_inscrits)"/>
                                    personnes
                                </p>
                                <p>
                                    - Le nombre de candidats présents était de
                                    <span t-esc="docs.nbr_present_par_session(nbr_present)"/>
                                    personnes
                                </p>
                                <br/>
                                <p>B) Nombre de candidats reçus à l’examen
                                    <span t-esc="docs.nbr_recus_par_session(total_nbr_recu)"/>
                                    sur
                                    <span t-esc="docs.nbr_client_par_session(nbr_inscrits)"/>
                                </p>
                                <p>- Le taux de réussite est donc de
                                    <span
                                            t-esc="docs.pourcentage_client_recu(pourcentage)"/>
                                    %.
                                </p>
                                <br/>
                                <p>c) Liste récapitulative des candidats inscrits, absents, reçus ou ajournés en
                                    annexe.
                                </p>
                                <br/>
                                <p>d) Le constat du déroulement des épreuves ainsi que la mention des éventuelles
                                    difficultés rencontrées lors du déroulement de la
                                    session :
                                </p>
                                <p>Aucune difficulté n’est à mentionner, tout s’est bien déroulé.</p>
                                <br/>
                                <p>e) Le dossier d’inscription à l’examen du candidat, accompagné du relevé des notes
                                    obtenues
                                    aux différentes épreuves ainsi que de la
                                    copie d’examen.
                                    <br/>
                                    Ces éléments se trouvent dans le dossier de chaque candidat
                                </p>
                                <br/>
                            </span>
                            <br/>
                            <style>
                                .tr, .td , .table{
                                padding: 2px;
                                border: solid;
                                }
                            </style>
                            <center style="padding-top:10pt!important;">
                                <table class="table">
                                    <tbody>
                                        <tr>
                                            <td class="td" align="center" style="height: 200px; width: 200px;">
                                                <b>Remarques</b>
                                            </td>
                                            <td class="td" align="center" style="height: 200px; width: 600px;">
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </center>
                        </div>
                        <p style="page-break-after:always;"/>
                        <div class="row">
                            <img src='/mcm_session/static/src/img/header_middle.png' height="60" width="2000"/>
                        </div>
                        <div class="page" style="margin-left:10%;margin-right:10%;">

                            <p style="padding-top:50px;">
                                <b>
                                    <u>PERSONNES PRESENTES :</u>
                                </b>
                            </p>
                            <style>
                                .th, .tr, .td , .table{
                                padding: 1px;
                                border: solid;
                                }
                            </style>
                            <div class="row" style="padding-top:40px!important;">
                                <table class="table">
                                    <tbody>
                                        <thead>
                                            <tr class="tr">
                                                <th class="td">Nom et prénom</th>
                                                <th width="0" class="td">Fonction</th>
                                                <th class="td">Date</th>
                                                <th class="td">Signature</th>
                                            </tr>
                                        </thead>
                                        <tr t-foreach='o.intervenant_id' t-as='lines'>
                                            <td class="td" style="height:60px;width:200px;">
                                                <span t-esc="lines.intervenant_id.display_name"/>
                                            </td>
                                            <td class="td" style="height:60px;width:200px;">
                                                <span t-esc="lines.fonction_id.name"/>
                                            </td>
                                            <td class="td" style="height:60px;width:200px;">
                                                <span t-esc="(o.date_exam).strftime('%d/%m/%Y')"/>
                                            </td>
                                            <td class="td" style="height:60px;width:200px;">
                                                <span></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="td" style="height:60px;width:200px;"></td>
                                            <td class="td" style="height:60px;width:200px;"></td>
                                            <td class="td" style="height:60px;width:200px;"></td>
                                            <td class="td" style="height:60px;width:200px;"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <p style="padding-top: 40px;font-size:22px;">Cette session est présidée par
                                .........................................................................................................
                                :
                            </p>
                            <p>
                                <b>Date :</b>
                                <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d/%m/%Y')"/>
                            </p>
                            <p>
                                <b>Heure :</b>
                                <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%H:%M:%S')"/>
                            </p>
                            <p>
                                <b>Signature :</b>
                            </p>
                        </div>
                    </div>
                    <p style="page-break-after:always;"/>

                    <!-- 4 éme page : tableau de statestique-->
                    <div class="page">
                        <img src='/mcm_session/static/src/img/header_middle.png' height="60" width="2000"/>
                        <style>
                            .th{
                            height: 50px;
                            width: 12%;
                            vertical-align: middle;
                            text-align: center;

                            background: #E6E6FA;}

                            .td {
                            white-space: nowrap;
                            height: 30px;
                            width: 9%;
                            vertical-align: middle;
                            text-align: center;

                            }
                            .table{
                            table-layout: fixed;
                            margin-left: 10px;
                            margin-right: 10px;
                            text-align: center;}
                        </style>
                        <div class="page-margin">
                            <table class="table">
                                <tbody>
                                    <tr>
                                        <th colspan="8" class="th">
                                            <span t-esc="o.name"/>
                                            -
                                            <span t-esc="o.session_adresse_examen.adresse_centre_examen"/>
                                            -
                                            <t t-if="o.temps_convocation == 'matin'">
                                                <span t-field="o.heure_examen_matin"/>
                                            </t>
                                            <t t-if="o.temps_convocation == 'apres_midi'">
                                                <span t-field="o.heure_examen_apres_midi"/>
                                            </t>
                                        </th>
                                    </tr>

                                    <tr>
                                        <th class="th">Nombre d'inscrits
                                            <td class="td">
                                                <span t-esc="docs.nbr_client_par_session(nbr_inscrits)"/>
                                            </td>
                                            <td class="td">100 %</td>
                                            <th class="th"></th>
                                            <th class="th">Solo</th>
                                            <th class="th">Pro</th>
                                            <th class="th">Premium</th>
                                            <th class="th">Repassage</th>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th class="th">Nombre de présents
                                            <td class="td">
                                                <span t-esc="docs.nbr_present_par_session(nbr_present)"/>
                                            </td>

                                            <td class="td">
                                                <span t-esc="docs.prc_present(prc_present)"/>
                                                <span>%</span>
                                            </td>
                                        </th>
                                        <th class="th">Nombre d'inscrits
                                            <td class="td">
                                                <span>
                                                    <span t-esc="docs.pack_solo_inscrit(sum_solo_inscrit)"/>
                                                </span>
                                            </td>
                                            <td class="td">
                                                <span>
                                                    <span t-esc="docs.pack_pro_inscrit(sum_pro_inscrit)"/>
                                                </span>
                                            </td>
                                            <td class="td">
                                                <span>
                                                    <span t-esc="docs.pack_premium_inscrit(sum_premium_inscrit)"/>
                                                </span>
                                            </td>

                                            <td class="td">
                                                <span>
                                                    <span t-esc="docs.pack_repassage_inscrit(sum_repassage_inscrit)"/>
                                                </span>
                                            </td>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th class="th">Nombre d'absents
                                            <td class="td">
                                                <span t-esc="docs.calculer_nombre_absence(total_absence)"/>
                                            </td>

                                            <td class="td">
                                                <span t-esc="docs.pourcentage_absence(resultat)"/>
                                                <span>%</span>
                                            </td>
                                        </th>
                                        <th class="th">Nombre de présents
                                            <td class="td">
                                                <span t-esc="docs.pack_solo_present(sum_solo_present)"/>
                                            </td>
                                            <td class="td">
                                                <span t-esc="docs.pack_pro_present(sum_pro_present)"/>
                                            </td>
                                            <td class="td">
                                                <span t-esc="docs.pack_premium_present(sum_premium_present)"/>
                                            </td>
                                            <td class="td">
                                                <span t-esc="docs.pack_repassage_present(sum_repassage_present)"/>
                                            </td>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th class="th">Nombre d'absence justifiée
                                            <td class="td">
                                                <span t-esc="docs.calculer_nombre_absence_justifiée(total_absence_justifiée)"/>
                                            </td>

                                            <td class="td">
                                                <span t-esc="docs.pourcentage_absence_justifiée(resultat)"/>
                                                <span>%</span>
                                            </td>
                                        </th>
                                        <th class="th">Taux de présence
                                            <td class="td">
                                                <span t-esc="docs.taux_de_presence_solo()"/>
                                                <span>%</span>
                                            </td>
                                            <td class="td">
                                                <span t-esc="docs.taux_de_presence_pro()"/>
                                                <span>%</span>
                                            </td>
                                            <td class="td">
                                                <span t-esc="docs.taux_de_presence_premium()"/>
                                                <span>%</span>
                                            </td>
                                            <td class="td">
                                                <span t-esc="docs.taux_de_presence_repassage()"/>
                                                <span>%</span>
                                            </td>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th class="th">Nombre d'abandon
                                            <td class="td">
                                                <span t-esc="o.count_annule"/>
                                            </td>

                                            <td class="td">
                                                <span t-esc="docs.pourcentage_abandon(prc_abandon)"/>
                                                <span>%</span>
                                            </td>
                                        </th>
                                        <th class="th">Nombre d'admis
                                            <td class="td">
                                                <span t-esc="docs.nbr_recus_solo()"/>
                                            </td>
                                            <td class="td">
                                                <span t-esc="docs.nbr_recus_pro()"/>
                                            </td>
                                            <td class="td">
                                                <span t-esc="docs.nbr_recus_premium()"/>
                                            </td>
                                            <td class="td">
                                                <span t-esc="docs.nbr_recus_repassage()"/>
                                            </td>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th class="th">Nombre d'admis
                                            <td class="td">
                                                <span t-esc="docs.nbr_recus_par_session(total_nbr_recu)"/>
                                            </td>

                                            <td class="td">
                                                <span t-esc="docs.pourcentage_client_recu(pourcentage)"/>
                                                <span>%</span>
                                            </td>
                                        </th>
                                        <th class="th">Taux de réussite
                                            <td class="td">
                                                <span t-esc="docs.taux_de_reussite_solo()"/>
                                                <span>%</span>
                                            </td>
                                            <td class="td">
                                                <span t-esc="docs.taux_de_reussite_pro()"/>
                                                <span>%</span>
                                            </td>
                                            <td class="td">
                                                <span t-esc="docs.taux_de_reussite_premium()"/>
                                                <span>%</span>
                                            </td>
                                            <td class="td">
                                                <span t-esc="docs.taux_de_reussite_repassage()"/>
                                                <span>%</span>
                                            </td>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th class="th">Nombre d'échec
                                            <td class="td">
                                                <span t-esc="docs.nbr_echec(nbr_echec)"/>
                                            </td>

                                            <td class="td">
                                                <span t-esc="docs.pourcentage_echec(prc_echec)"/>
                                                <span>%</span>
                                            </td>
                                        </th>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <style>
                        .page-margin
                        {
                        margin-top: 40px
                        }
                        .td {
                        white-space: nowrap;
                        height: 30px;
                        width: 9%;
                        vertical-align: middle;
                        text-align: center;

                        }
                        .table{
                        table-layout: auto;
                        margin-left: auto;
                        margin-right: auto;
                        width: 80%;
                        text-align: center;}
                    </style>
                    <div class="page-margin" style="padding-top:30px">
                        <table class="table">
                            <tbody>
                                <thead>
                                    <tr class="tr">
                                        <th class="th">Nom et prénom</th>
                                        <th class="th">Pack</th>
                                        <th class="th">NOTE QCM</th>
                                        <th class="th">NOTE QRO</th>
                                        <th class="th">Moyenne</th>
                                        <th class="th">Nombre de passage</th>
                                        <th class="th">Date de formation</th>
                                        <th class="th">Resultat</th>
                                    </tr>
                                </thead>
                                <tr t-foreach='o.client_ids' t-as='line'>
                                    <td class="td">
                                        <span>
                                            <t t-if="line.note_exam_id">
                                                <strong>
                                                    <span t-esc="line.note_exam_id.partner_id.display_name"/>
                                                </strong>
                                            </t>
                                        </span>
                                    </td>
                                    <td class="td">
                                        <t t-if="line.note_exam_id">
                                            <t t-if="line.module_id.product_id.default_code == 'basique'">
                                                <span>Solo</span>
                                            </t>
                                            <t t-if="line.module_id.product_id.default_code == 'avancee'">
                                                <span>Pro</span>
                                            </t>
                                            <t t-if="line.module_id.product_id.default_code == 'premium'">
                                                <span>Premium</span>
                                            </t>
                                            <t t-if="line.module_id.product_id.default_code == 'examen'">
                                                <span>Repassage</span>
                                            </t>
                                        </t>
                                    </td>
                                    <td class="td">
                                        <t t-set="session"
                                           t-value="line.note_exam_id.filtered(lambda se: se.date_exam == o.date_exam)"/>
                                        <t t-if="session.presence == 'present'">
                                            <span t-esc="'%.0f' % session.epreuve_a"/>
                                            <span>/100</span>
                                        </t>
                                        <t t-if="session.epreuve_a == 0 and session.epreuve_b == 0 and session.presence != 'present'">
                                            <span></span>
                                        </t>
                                    </td>
                                    <td class="td">
                                        <t t-set="session"
                                           t-value="line.note_exam_id.filtered(lambda se: se.date_exam == o.date_exam)"/>
                                        <t t-if="session.presence == 'present'">
                                            <span t-esc="'%.0f' % session.epreuve_b"/>
                                            <span>/ 100</span>
                                        </t>
                                        <t t-if="session.epreuve_a == 0 and session.epreuve_b == 0 and session.presence != 'present'">
                                            <span></span>
                                        </t>
                                    </td>
                                    <t t-if="session.resultat != 'ajourne' and session.presence == 'present'">
                                        <td class="td">
                                            <t t-set="session"
                                               t-value="line.note_exam_id.filtered(lambda se: se.date_exam == o.date_exam)"/>
                                            <t t-if="session.moyenne_generale != 0">
                                                <span t-esc="'%.0f' % session.moyenne_generale"/>
                                                <span>/200</span>
                                            </t>
                                            <t t-else="">
                                                <span></span>
                                            </t>
                                        </td>
                                    </t>
                                    <t t-if="session.resultat == 'ajourne' and session.presence == 'present'">
                                        <td class="td">
                                            <t t-set="session"
                                               t-value="line.note_exam_id.filtered(lambda se: se.date_exam == o.date_exam)"/>
                                            <t t-if="session.moyenne_generale != 0">
                                                <span t-esc="'%.0f' % session.moyenne_generale"/>
                                                <span>/200</span>
                                            </t>
                                            <t t-else="">
                                                <span></span>
                                            </t>
                                        </td>
                                    </t>
                                    <t t-if="session.resultat == 'ajourne' and session.presence != 'present'">
                                        <td class="td" style="background-color:#E9967A;">
                                            <t t-set="session"
                                               t-value="line.note_exam_id.filtered(lambda se: se.date_exam == o.date_exam)"/>
                                            <strong>
                                                <span>Absent</span>
                                            </strong>
                                        </td>
                                    </t>

                                    <td class="td">
                                        <t t-set="session"
                                           t-value="line.note_exam_id.filtered(lambda se: se.date_exam == o.date_exam)"/>
                                        <t>
                                            <span t-esc="session.nombre_de_passage"/>
                                        </t>
                                    </td>
                                    <td class="td">
                                        <t t-set="sales"
                                           t-value="line.sale_order_ids.filtered(lambda sl: sl.state == 'sale')"/>
                                        <t t-set="financement_mode"
                                           t-value="line.mode_de_financement == 'particulier'"/>
                                        <t t-if="sales and financement_mode">
                                            <span t-esc="(sales[0].signed_on).strftime('%d/%m/%Y')"/>
                                        </t>
                                        <t t-else="">
                                            <t t-if="line.date_creation">
                                                <span t-esc="datetime.datetime.strptime(str(line.date_creation),'%d/%m/%Y').date().strftime('%d/%m/%Y')"/>
                                            </t>
                                            <t t-else="">
                                                <span>.........</span>
                                            </t>
                                        </t>
                                        -
                                        <span t-field="line.module_id.date_exam"
                                              t-field-options='{"format": "dd/MM/yyyy"}'/>
                                    </td>

                                    <t t-set="session"
                                       t-value="line.note_exam_id.filtered(lambda se: se.date_exam == o.date_exam)"/>
                                    <t t-if="session.resultat == 'ajourne'">
                                        <td class="td">
                                            <span style="color:#B22222">
                                                <strong>
                                                    <t t-esc="{False: False,'ajourne': 'Ajourné(e)'}[session.mention]"></t>
                                                </strong>
                                            </span>
                                        </td>
                                    </t>
                                    <t t-else="">
                                        <td class="td">
                                            <span style="color:#4CAF50;">
                                                <strong>
                                                    <t t-esc="{False: False, 'recu': 'Reçu(e)'}[session.mention]"></t>
                                                </strong>
                                            </span>
                                        </td>
                                    </t>
                                </tr>
                                <tr>
                                    <th class="th" colspan="2">Moyenne générale</th>
                                    <td class="td">
                                        <span t-esc="o.moyenne_qcm()"/>
                                        <span>/ 100</span>
                                    </td>
                                    <td class="td">
                                        <span t-esc="o.moyenne_qro()"/>
                                        <span>/ 100</span>
                                    </td>
                                    <td class="td" style="background: #87CEEB;">
                                        <b>
                                            <span t-esc="o.moyenne_des_somme_qcm_qro()"/>
                                            <span>/ 200</span>
                                        </b>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                    </div>
                </t>
            </t>
            <div class="footer" style="position:absolute; margin:0px; padding:0px">
                <img src='/mcm_session/static/src/img/footer_jury.png'
                     height="80" width="2000"/>
            </div>
        </t>
    </template>
</odoo>